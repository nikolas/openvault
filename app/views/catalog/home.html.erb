<% content_for :head do %>
<script type="text/javascript">
  $(function() {
    $('#carousel').slidesjs({
      // config for "Previous" / "Next" buttons.
      navigation: {active: false},

      // config for playing the slideshow.
      play: {
        active: true,
        auto: true,
        interval: 10000
      }
    });
  });
</script>
<% end %>


<% title "#{application_name} - Home" %>
<div class="row-fluid">
  <div id="carousel" class="grainbox span8">
    <% @carousel_items.each_with_index do |ex, idx| %>
      <div class="carousel-item slidesjs-slide <%= (idx == 0) ? 'active' : '' %> row-fluid" item-num="<%= idx %>">
        <div class="image span12 overlayable">
          <%= link_to image_tag(ex.image), ex.url %>

          <div class="overlay-bottom">
            <h4><%= ex.title %></h4>
            <p><%= truncate(ex.body, length: 720).html_safe %></p>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  <div id="home_sidebar" class="span4">

    <div id="welcome" class="grainbox">
      <h2>What is the <%= application_name %>?</h2>
      <div class="sep-line"></div>
      <p>We provide online access to unique and historically important content produced by the public television and radio station WGBH. So have a look around and explore!</p>
    </div>

    <br />

    <div id="collections" class="grainbox">
      <h2>Scholar Collections</h2>
      <div class="sep-line"></div>
      <% @custom_collections.each do |coll| %>
        <div class="collection_block">
          <h5 class="collection_title"><%= link_to coll.name, coll %></h5>
          <span class="collection_owner">by <%= link_to coll.owner.full_name, coll.owner %></span>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="row-fluid">
  <div class="span12"></div>
</div>

<div class="row-fluid">
  <div id="blog" class="span8">
    <h2>From the blog</h2>
    <div class="sep-line"></div>
    <div class="row-fluid">
      <div id="featured-post" class="span7">
        <% feature = Wordpress.get_post(:id => 1582) rescue nil %>
        <% if feature != nil %>
        <%= image_tag feature.images('thumbnail')['url'], alt: feature.title %>
        <h3><%= feature.title %></h3>
        <p><%= truncate(sanitize(feature.content, tags: %w{a, strong, em, p}) , :length => 800).html_safe %></p>
        <a href="<%= feature.url %>" class="action_link">Read more</a>
        <% else %>
        <p>We seem to be having a problem, please check back later.</p>
        <% end %>
      </div>
      <div id="more-posts" class="span5">
        <% posts = Wordpress.get_recent_posts(:count => 3) rescue nil %>
        <% posts.each do |post| %>
          <div class="post row-fluid">
          	<div class="body span12">
          		<h3><%= post.title %></h3>
          		<p><%= truncate(post.excerpt, :length => 180).html_safe %><a href="<%= post.url %>">Read more</a></p>
        		</div>
        	</div>
      	<% end rescue nil %>
        <% if posts != nil %>
          <a href="/blog" class="action_link" style="display:block;text-align:center;width:100%;">View all</a>
        <% end %>
      </div>
    </div>
  </div>
  <div id="tweets" class="span4">
    <h2>
      @WGBHArchives
    </h2>

    <div class="sep-line"></div>

    <a class="twitter-timeline" data-dnt="true" width="100%" height="475px" href="https://twitter.com/wgbharchives" data-widget-id="471296080181596162">Tweets by @wgbharchives</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  </div>
</div>
<ul class="tools">
  <% if current_user && current_user.role == 'scholar' %>
    
    <% if current_user && current_user.owned_collections.empty? && current_user.custom_collection_collabs.empty? %>
      <li class="create_collection">
        <button class="btn btn-mini" type="button"><%= link_to 'Create new collection', new_custom_collection_path %></button>
      </li>
    <% else %>
      <span style="position:relative;" >
        <span class="arrow" ></span>
          <% @menu_collection = current_user.collections.map{|c| [ c.name, c.id ] }.compact %>
          <% @menu_collection << ['Create a new collection...', 'new'] %>
          <% @disabled_menus = current_user.collections.map{|c| c.id if c.has_item?(@document.id)  } %>
          <form>
            <%= label_tag :collection_id, 'Add to collection' %>
            <%= select_tag(:collection_id, options_for_select(@menu_collection, disabled: @disabled_menus), {:prompt => 'Add to collection...', :id => 'add_to_collection'}) %>
          </form>
          <script>
            $('#add_to_collection').change(function(){
              var collectionId = $(this).val();
              var assetId = "asset_id=<%= @document.id %>";
              var kind = "kind=<%= @document['active_fedora_model_ssi'] %>";

              if(collectionId == 'new'){
                $.cookie('redirect_to', window.location.toString(), {path: '/'});
                window.location = "<%= new_custom_collection_path %>";
              } else if(collectionId) {
                var addToCollectionLink = "/custom_collections/"+collectionId+"/add_item?"+assetId+"&"+kind;
                // NOTE RB: This should *not* be a GET request (but instead, a PUT request)
                // Needs to be fixed, this is how I found it.
                window.location = addToCollectionLink;
              }
            })
          </script>
        </span>
    <% end %>
  <% end %>
  <li class="share">
    <div class="addthis_toolbox addthis_default_style">
      <a class="addthis_button_compact at300m" href="#"><span class="at16nc at300bs at15nc at15t_compact at16t_compact"><span class="at_a11y">More Sharing Services</span></span></a>
      <a class="addthis_button_preferred_3 addthis_button_email at300b" title="Email" href="#"><span class="at16nc at300bs at15nc at15t_email at16t_email"><span class="at_a11y">Share on email</span></span></a>
      <a class="addthis_button_preferred_2 addthis_button_twitter at300b" title="Tweet" href="#"><span class="at16nc at300bs at15nc at15t_twitter at16t_twitter"><span class="at_a11y">Share on twitter</span></span></a>
      <a class="addthis_button_preferred_1 addthis_button_facebook at300b" title="Facebook" href="#"><span class="at16nc at300bs at15nc at15t_facebook at16t_facebook"><span class="at_a11y">Share on facebook</span></span></a>
    <div class="atclear"></div></div>
    <script type="text/javascript">
      var addthis_config = { ui_click: true }

      $(function() {
        addthis_config = { ui_click: true, data_track_clickback: true, data_ga_property: 'UA-237277-2'}
        $('<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=interactivetech"></' + 'script>').insertAfter('.addthis_button_compact');

      });
    </script>
  </li>
  <!-- <li class="cite">
    <a href="/catalog/<%= @document.id %>/cite">Cite</a>
  </li> -->
</ul>
